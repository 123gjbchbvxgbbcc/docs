# 安装和配置插件

::: tip
本节将介绍「插件市场」「插件配置」和「依赖管理」页面的使用方法。
:::

项目启动成功后，会自动为你打开一个浏览器界面。你可以使用界面中的控制台进行一系列操作，包括修改配置、安装插件、更新插件和添加机器人等。我们将以 echo 插件为例来演示插件的安装与配置。echo 插件的功能是提供一个 echo 指令，它会将用户的输入原样输出给用户。

## 安装插件

::: warning
Koishi 不对非官方插件的安全性做任何保证。请不要随意下载来源不明的插件，因为它们可能导致 Koishi 无法运行，甚至更严重的后果。如果你下载插件后遇到了问题，可以前往用户群或论坛进行反馈。此外，部分插件带有「不安全」标识，安装此类插件将不会受到官方群内的支持。
:::

前往「插件市场」页面，你将在这里看到所有可下载的插件。在搜索栏中输入 echo，找到我们想要的插件，点击「添加」按钮，然后在弹出的对话框中点击「安装」。等待片刻，插件就已经安装成功了。

![market](/manual/console/market_light.webp) {.light-only}

![market](/manual/console/market_dark.webp) {.dark-only}

## 启用和停用插件

插件安装成功以后并不会立即处于运行状态，我们需要对其进行配置。前往「插件配置」页面，左侧栏中列出了已配置的各种插件。其中黑色字体显示的是正在运行的插件，而灰色字体则对应尚未运行的插件。我们可以看到此时 echo 插件确实并未运行。好消息是，echo 插件并没有什么需要配置的地方。我们可以直接点击右上角的「启用插件」，这样 echo 插件就已经处于运行状态了。

<!-- echo -->

要停用 echo 插件同样很简单。点击右上角的「停用插件」，插件变会停止运行。停用插件既不会删除插件的代码，也不会删除插件的配置，你可以随时重新启用它。

## 配置插件

::: warning
在配置插件的过程中，请大家记住这个原则：**如果没有必要，那么不要改动任何配置**。Koishi 预装了许多插件，你在插件配置页面中看到的每一个插件都实现了 Koishi 的一部分基础功能。包括我们已经用到的「插件市场」和「插件配置」页面本身也是由预装的 market 插件来提供的。所有的预装插件均已配置完善，你不需要对它们进行任何修改。随意改动插件配置、删除预装插件都可能导致 Koishi 无法正常运行 (甚至错误地添加了某些插件也会导致 Koishi 无法运行)。
:::

虽然 echo 插件没有需要配置的地方，但更复杂的插件则通常会提供各种配置项，允许使用者控制插件的行为。下图展示了 novelai 插件的配置界面。

![settings](/manual/console/settings_light.webp) {.light-only}

![settings](/manual/console/settings_dark.webp) {.dark-only}

在这个界面中，我们可以看到许多配置项。其中你需要注意：

- 必选但尚未填入的配置项会在左侧呈现 <span style="font-weight: bold; color: var(--vp-c-red-light)">红色</span> 的提示条，它们必须被正确填写才能启动插件
- 已修改但未保存的配置项会在左侧呈现 <span style="font-weight: bold; color: var(--vp-c-brand)">紫色</span> 的提示条，它们会在你点击「启用插件」或「保存配置」按钮后保存；如果你想放弃这些改动，可以在配置名称旁的小三角处呼出菜单，选择「撤销更改」来使该配置恢复到上次保存时的状态

### 添加和删除配置

::: warning
手动添加或删除配置是进阶用法，请务必谨慎操作！
:::

当一个插件被安装完成后，插件市场将自动为你跳转到对应的配置界面。但也有一些进阶操作，允许你手动添加或删除插件的配置。

在「全局配置」或任意分组界面中，点击右上角的「添加插件」将会弹出对话框。在对话框中点击要添加的插件，即可创建一份未启用的插件配置 (请阅读 [维护多份配置](#维护多份配置))。

在任何插件的配置界面点击右上角的「删除插件」可删除这份配置。此操作无法被撤销，如果你想要恢复之前的配置，只能再次手动添加。

### 维护多份配置

有很多情况下你会想要维护同一个插件的多份配置：

- 你希望同时运行多个插件实例
- 你希望在合适的时机切换另一份插件配置
- 你希望在不同的群中使用不同的插件配置

不同的需求往往有不同的解决方案，因此我无法给你统一的答案。但好在对于上面的三种情况 Koishi 都已经提供了支持，且听我给您慢慢说道。

在同一个 Koishi 应用中，有些插件可以同时启用多份，有些则不能——这并非插件的实现缺陷，而是预期的行为。事实上，插件的作者可以指定具体哪些功能可以被独立地启用。这表现在插件上就是两种不同的类型：那些可以同时启用多份的插件被称为可重用插件，反之则称为不可重用插件。

典型的可重用插件是 [适配器插件](./adapter.md)。每个适配器对应着一个正在运行的机器人，不同平台的机器人由不同的适配器进行配置。因此，如果你想在同一个平台中配置多个机器人，直接按照上一节中的方法添加多个适配器插件即可。

与此同时，绝大多数插件都是不可重用的。对于这类插件，你只能同时拥有一份运行中的配置。如果已经有一份正在运行的配置，那么你会在其他配置处看到一行提示「此插件正在运行且不可重用」。当然，你仍然可以准备多份配置，并在合适的时机将一份配置停用，并启用另一份。

对于那些不可重用的插件，如果你希望在不同的场景下切换到不同的配置，[过滤器](../usage/filter.md) 一节将解决你的问题。

## 分组管理插件

Koishi 提供了插件分组的机制，允许你将插件放入不同的分组统一管理。一个刚刚创建好的 Koishi 实例已经预先配置了四个分组，而新安装的插件将自动添加到插件列表的底部，不属于任何分组。你可以将在左侧栏中拖动插件，改变插件的排列顺序或移至别的分组内部。

你同样可以创建新的分组。在「全局配置」或任意分组界面中，点击右上角的「创建分组」按钮，你将创建一个新的插件分组。分组可以在左侧栏中点击小三角来控制展开和收起，还可以配置 [过滤器](../usage/filter.md)，你由此得以获得了同时控制一组插件行为的能力。

## 更新和卸载插件

前往「依赖管理」页面，你可以在这里看到依赖列表，你可以在这里更新你的依赖，当状态显示为「可更新」时，点击右侧的「修改」按钮，在弹出的窗口左上角选择你需要的版本，点击右下角的「更新」即可完成更新。

![dependencies](/manual/console/dependencies_light.webp) {.light-only}

![dependencies](/manual/console/dependencies_dark.webp) {.dark-only}
