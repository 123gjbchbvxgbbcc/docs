# 权限管理

::: danger
此页面尚未完成。请过几天再来看看吧~
:::

在实际的机器人开发过程中，用户系统往往是必不可少的一环——它在展现机器人功能多样性的同时也避免了某个功能被滥用的情况。本章就来介绍 Koishi 内置的用户系统，以及用户数据是如何与指令调用相联系的。

## 用户权限

Koishi 内部有一套默认的权限系统，它存储于用户数据的 `authority` 字段，并遵循下面的 **核心规则**：

- 数据库中没有的用户默认拥有 0 级权限
- 高权限者能够执行一切低权限者的操作

当我们调用 `database.getUser()` 这样的原始接口向数据库请求用户资料时，如果该用户不存在，则会返回 `undefined`；但当我们调用 `session.getUser()` 这样的高级接口时，如果该用户不存在，则返回一个默认的 0 级用户对象而不是 `null`。这种特性能够尽可能减少用户存在性的判断代码——我们认为任何账号都是存在于数据库的，只不过有些是 0 级而已。

在此基础上，我们还扩充出了这样的一套 **设计准则**：

- 0 级：不存在的用户
- 1 级：所有用户，只能够接触有限的功能
- 2 级：高级用户，能够接触几乎一切机器人的功能
- 3 级：管理员，能够直接操作机器人事务
- 4 级：高级管理员，能够管理其他账号

这套准则被用于 Koishi 的所有官方包的指令中，但是你也可以手动进行更改，扩展出你所需要的权限系统。稍后，我们将看到这些权限是如何被用于指令调用的。

## 自动注册

默认情况下，对于每一条接收到的消息，机器人都会自动注册其用户和频道。如果你不希望此行为，可以

前面已经介绍过了，默认情况下每一名用户都是 0 级权限，每一个群都没有代理者，这虽然安全但也给 Koishi 的搭建带来了不小的麻烦。因此，我们也提供了自动注册的配置项：`autoAuthorize` 和 `autoAssign`。下面展示两个例子：

```yaml title=koishi.yml
# 一旦收到来自未知频道的消息，就自动注册频道数据，代理者为收到消息的人
autoAssign: true
# 一旦收到来自未知用户的消息，就自动注册用户数据，权限等级为 1
autoAuthorize: 1
```
